!function(){"use strict";const e=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o&&(o.textContent="",o.classList.remove(r.errorClass))},t=(e,t,o)=>{(e=>e.some(e=>!e.validity.valid))(e)?r(t,o):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)},r=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},o={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"disabledBtn",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},n=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}addNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}toggleLikeCard(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"7ca7dbe9-72ae-4982-a982-e599cd27fed8","Content-Type":"application/json"}});n.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=D(e);U.append(t)})}).catch(console.error),n.getInitialCards().then(e=>{e.forEach(e=>{const t=D(e);U.append(t)})}).catch(console.error);const a=document.querySelector(".profile__edit-btn"),s=document.querySelector("#edit-profile-modal"),c=(s.querySelector(".modal__close-btn"),s.querySelector(".modal__form")),l=s.querySelector("#profile-name-input"),i=s.querySelector("#profile-description-input"),d=document.querySelector(".profile__new-post-btn"),u=document.querySelector("#new-post-modal"),m=u.querySelector(".modal__submit-btn"),_=(u.querySelector(".modal__close-btn"),u.querySelector(".modal__form")),h=u.querySelector("#card-image-input"),f=u.querySelector("#card-caption-input"),y=u.querySelector(".modal__image"),S=u.querySelector(".modal__caption"),v=document.querySelector(".profile__avatar-btn"),b=document.querySelector("#avatar-modal"),p=(b.querySelector(".modal__submit-btn"),b.querySelector(".modal__close-btn"),b.querySelector(".modal__form")),q=b.querySelector("#profile-avatar-input"),E=document.querySelector(".profile__avatar"),C=document.querySelector("#delete-modal"),k=(C.querySelector(".modal__close-btn"),C.querySelector("#modal__cancel-btn")),L=C.querySelector("#modal__delete-btn"),g=C.querySelector(".modal__form"),x=document.querySelector(".profile__name"),$=document.querySelector(".profile__description"),j=document.querySelector("#card-template"),U=document.querySelector(".cards__list"),P=document.querySelector("#preview-modal"),I=(P.querySelector(".modal__close-btn"),P.querySelector(".modal__image")),A=P.querySelector(".modal__caption");let w,B;function D(e){const t=j.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image");return o.src=e.link,o.alt=e.name,r.textContent=e.name,t.querySelector(".card__like-btn").addEventListener("click",t=>function(e,t){const r=e.target.classList.contains("card__like-btn_active");n.toggleLikeCard(t,r).then(t=>{t&&e.target.classList.toggle("card__like-btn_active")}).catch(console.error)}(t,e._id)),t.querySelector(".card__delete-btn").addEventListener("click",()=>function(e,t){w=e,B=t,N(C)}(t,e._id)),L.addEventListener("click",()=>{t.remove(),O(C)}),k.addEventListener("click",()=>{O(C)}),o.addEventListener("click",()=>{I.src=e.link,I.alt=e.name,A.textContent=e.name,N(P)}),t}function T(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&O(e)}}function N(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",T),document.addEventListener("click",J)}function O(e){e.classList.remove("modal_is-opened"),document.removeEventListener("click",J),document.removeEventListener("keydown",T)}document.querySelector(".error"),document.querySelector(".error__message"),a.addEventListener("click",function(){l.value=x.textContent,i.value=$.textContent,((r,o,n)=>{o.forEach(t=>{e(r,t,n)});const a=r.querySelector(n.submitButtonSelector);t(o,a,n)})(c,[l,i],o),N(s)}),d.addEventListener("click",function(){N(u)}),v.addEventListener("click",function(){N(b)}),document.querySelectorAll(".modal__close-btn").forEach(e=>{const t=e.closest(".modal");e.addEventListener("click",()=>O(t))}),s.addEventListener("submit",function(e){e.preventDefault(e);const t=e.submitter;t.textContent="Saving...",n.editUserInfo({name:l.value,about:i.value}).then(e=>{e&&(x.textContent=e.name,$.textContent=e.about),O(s),c.reset(),r(editProfileSubmitBtn,o)}).catch(console.error).finally(()=>{t.textContent="Save"})}),u.addEventListener("submit",function(e){e.preventDefault(e);const t=e.submitter;t.textContent="Saving...",n.addNewCard({name:f.value,link:h.value}).then(e=>{e&&(S.textContent=e.name,y.textContent=e.link),O(u),_.reset(),r(m,o)}).catch(console.error).finally(()=>{t.textContent="Save"})}),b.addEventListener("submit",function(e){e.preventDefault(e);const t=e.submitter;t.textContent="Saving...",n.editAvatarInfo(q.value).then(e=>{e&&(E.src=e.avatar),O(b),p.reset()}).catch(console.error).finally(()=>{t.textContent="Save"})}),g.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;t.textContent="Deleting...",n.deleteCard(B).then(()=>{w.remove(),O(C)}).catch(console.error).finally(()=>{t.textContent="Delete"})});const J=e=>{e.target.classList.contains("modal")&&O(e.target)};(r=>{document.querySelectorAll(r.formSelector).forEach(o=>{((r,o)=>{const n=Array.from(r.querySelectorAll(o.inputSelector)),a=r.querySelector(o.submitButtonSelector);t(n,a,o),n.forEach(s=>{s.addEventListener("input",function(){((t,r,o)=>{r.validity.valid?e(t,r,o):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n&&(n.textContent=r,n.classList.add(o.errorClass))})(t,r,r.validationMessage,o)})(r,s,o),t(n,a,o)})})})(o,r)})})(o)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCxJQUNmQSxFQUFRMkcsaUJBQWlCLFFBQVMsV0FwRGY4QixFQUFDMUksRUFBUUMsRUFBU0MsS0FDcENELEVBQVFjLFNBQVNDLE1BUWxCakIsRUFBZUMsRUFBUUMsRUFBU0MsR0EzQmpCeUksRUFBQzNJLEVBQVFDLEVBQVMySSxFQUFVMUksS0FDL0MsTUFBTUMsRUFBVUgsRUFBT0ksY0FBYyxJQUFJSCxFQUFRSSxZQUNqREosRUFBUUssVUFBVWUsSUFBSW5CLEVBQWlCTSxpQkFDbkNMLElBQ0FBLEVBQVFNLFlBQWNtSSxFQUN0QnpJLEVBQVFHLFVBQVVlLElBQUluQixFQUFpQlEsY0FldkNpSSxDQUNJM0ksRUFDQUMsRUFDQUEsRUFBUTRJLGtCQUNSM0ksSUErQ0F3SSxDQUFtQjFJLEVBQVFDLEVBQVNDLEdBQ3BDUyxFQUFrQkMsRUFBV0MsRUFBVVgsRUFDM0MsTUFPQXFJLENBQWtCdkksRUFBUUUsTUNxUGxDNEksQ0FBaUI1SSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGVycm9yTXNnLCB2YWxpZGF0aW9uQ29uZmlnKSA9PiB7XHJcbiAgICBjb25zdCBlcnJvckVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcbiAgICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgaWYgKGVycm9yRWwpIHtcclxuICAgICAgICBlcnJvckVsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XHJcbiAgICAgICAgZXJyb3JFbC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25Db25maWcuZXJyb3JDbGFzcyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIHZhbGlkYXRpb25Db25maWcpID0+IHtcclxuICAgIGNvbnN0IGVycm9yRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBpZiAoZXJyb3JFbCkge1xyXG4gICAgICAgIGVycm9yRWwudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgICAgIGVycm9yRWwuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmVycm9yQ2xhc3MpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgdmFsaWRhdGlvbkNvbmZpZykgPT4ge1xyXG4gICAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgICAgc2hvd0lucHV0RXJyb3IoXHJcbiAgICAgICAgICAgIGZvcm1FbCxcclxuICAgICAgICAgICAgaW5wdXRFbCxcclxuICAgICAgICAgICAgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSxcclxuICAgICAgICAgICAgdmFsaWRhdGlvbkNvbmZpZ1xyXG4gICAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XHJcbiAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWwpID0+ICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxufTtcclxuXHJcbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWwsIHZhbGlkYXRpb25Db25maWcpID0+IHtcclxuICAgIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgICAgIGRpc2FibGVkQnRuKGJ1dHRvbkVsLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCBkaXNhYmxlZEJ0biA9IChidXR0b25FbCwgdmFsaWRhdGlvbkNvbmZpZykgPT4ge1xyXG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uQ29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xyXG59O1xyXG5cclxuY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCB2YWxpZGF0aW9uQ29uZmlnKSA9PiB7XHJcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgdmFsaWRhdGlvbkNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvclxyXG4gICAgKTtcclxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIHZhbGlkYXRpb25Db25maWcpO1xyXG59O1xyXG5cclxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsLCB2YWxpZGF0aW9uQ29uZmlnKSA9PiB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICAgIGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuaW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcbiAgICBjb25zdCBidXR0b25FbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIHZhbGlkYXRpb25Db25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcblxyXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcblxyXG4gICAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgICAgICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9ICh2YWxpZGF0aW9uQ29uZmlnKSA9PiB7XHJcbiAgICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5mb3JtU2VsZWN0b3IpO1xyXG4gICAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXHJcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcImRpc2FibGVkQnRuXCIsXHJcbiAgICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICAgIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcclxufTtcclxuXHJcbmV4cG9ydCB7XHJcbiAgICBzaG93SW5wdXRFcnJvcixcclxuICAgIGhpZGVJbnB1dEVycm9yLFxyXG4gICAgY2hlY2tJbnB1dFZhbGlkaXR5LFxyXG4gICAgaGFzSW52YWxpZElucHV0LFxyXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUsXHJcbiAgICBkaXNhYmxlZEJ0bixcclxuICAgIHJlc2V0VmFsaWRhdGlvbixcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzLFxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbixcclxuICAgIHZhbGlkYXRpb25Db25maWcsXHJcbn07XHJcbiIsImltcG9ydCBcIi4uL3BhZ2VzL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgZW5hYmxlVmFsaWRhdGlvbixcclxuICAgIHZhbGlkYXRpb25Db25maWcsXHJcbiAgICByZXNldFZhbGlkYXRpb24sXHJcbiAgICBkaXNhYmxlZEJ0bixcclxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlLFxyXG4gICAgY2hlY2tJbnB1dFZhbGlkaXR5LFxyXG4gICAgc2hvd0lucHV0RXJyb3IsXHJcbiAgICBoaWRlSW5wdXRFcnJvcixcclxuICAgIGhhc0ludmFsaWRJbnB1dCxcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzLFxyXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XHJcblxyXG5jb25zdCBpbml0aWFsQ2FyZHMgPSBbXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBCcmlkZ2VcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiVmFsIFRob3JlbnNcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMS1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXHJcbiAgICAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIkEgdmVyeSBsb25nIGJyaWRnZSwgb3ZlciB0aGUgZm9yZXN0IGFuZCB0aHJvdWdoIHRoZSB0cmVlc1wiLFxyXG4gICAgICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy80LXBob3RvLWJ5LW1hdXJpY2UtbGFzY2hldC1mcm9tLXBleGVscy5qcGdcIixcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXHJcbiAgICAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgICB9LFxyXG5dO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogXCI3Y2E3ZGJlOS03MmFlLTQ5ODItYTk4Mi1lNTk5Y2QyN2ZlZDhcIixcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbn0pO1xyXG5cclxuYXBpLmdldEFwcEluZm8oKVxyXG4gICAgLnRoZW4oKFtjYXJkcywgZGF0YV0pID0+IHtcclxuICAgICAgICBjYXJkcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XHJcbiAgICAgICAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGRhdGEgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiUGxhY2Vob2xkZXIgTmFtZVwiLFxyXG4gICAgICAgICAgICBhYm91dDogXCJQbGFjZWhvbGRlciBEZXNjcmlwdGlvblwiLFxyXG4gICAgICAgICAgICBhdmF0YXI6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy84LXBob3RvLWJ5LWFsaS1tb3JzaGVkbG91LWZyb20tcGV4ZWxzLmpwZ1wiLFxyXG4gICAgICAgIH07XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG5cclxuYXBpLmdldEluaXRpYWxDYXJkcygpXHJcbiAgICAudGhlbigoY2FyZHMpID0+IHtcclxuICAgICAgICBjYXJkcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XHJcbiAgICAgICAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuXHJcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcclxuY29uc3QgZWRpdFByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xyXG5jb25zdCBlZGl0UHJvZmlsZUNsb3NlQnRuID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICBcIiNwcm9maWxlLW5hbWUtaW5wdXRcIlxyXG4pO1xyXG5jb25zdCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcclxuKTtcclxuXHJcbmNvbnN0IG5ld1Bvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25ldy1wb3N0LWJ0blwiKTtcclxuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcclxuY29uc3QgbmV3UG9zdFN1Ym1pdEJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xyXG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBuZXdQb3N0Rm9ybSA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBuZXdQb3N0SW1hZ2VJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XHJcbmNvbnN0IG5ld1Bvc3RDYXB0aW9uSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWNhcHRpb24taW5wdXRcIik7XHJcbmNvbnN0IG5ld1Bvc3RJbWFnZUVsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG5jb25zdCBuZXdQb3N0Q2FwdGlvbkVsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XHJcblxyXG5jb25zdCBhdmF0YXJNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWxTdWJtaXRCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbENsb3NlQnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbEZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJJbWFnZUlucHV0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcblxyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBjYW5jZWxNb2RhbEJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjbW9kYWxfX2NhbmNlbC1idG5cIik7XHJcbmNvbnN0IGRlbGV0ZU1vZGFsQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNtb2RhbF9fZGVsZXRlLWJ0blwiKTtcclxuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcblxyXG5jb25zdCBwcm9maWxlTmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25FbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XHJcblxyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XHJcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XHJcblxyXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XHJcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcclxuY29uc3QgcHJldmlld01vZGFsSW1hZ2VFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcclxuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbkVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XHJcblxyXG5jb25zdCBlcnJvckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lcnJvclwiKTtcclxuY29uc3QgZXJyb3JNc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVycm9yX19tZXNzYWdlXCIpO1xyXG5cclxubGV0IHNlbGVjdGVkQ2FyZDtcclxubGV0IHNlbGVjdGVkQ2FyZElkO1xyXG5cclxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudFxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcclxuICAgICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgY29uc3QgY2FyZFRpdGxlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gICAgY29uc3QgY2FyZEltYWdlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG5cclxuICAgIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICAgIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcclxuICAgIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG5cclxuICAgIGNvbnN0IGNhcmRMaWtlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xyXG4gICAgY2FyZExpa2VCdG5FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT5cclxuICAgICAgICBoYW5kbGVMaWtlQ2FyZChldnQsIGRhdGEuX2lkKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBjYXJkRGVsZXRlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XHJcbiAgICBjYXJkRGVsZXRlQnRuRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpXHJcbiAgICApO1xyXG5cclxuICAgIGRlbGV0ZU1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgY2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjYW5jZWxNb2RhbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICAgICAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcclxuICAgICAgICBwcmV2aWV3TW9kYWxDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcclxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICAgIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcclxuICAgIGFwaS5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgICAgc3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJEZWxldGVcIjtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSB7XHJcbiAgICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcclxuICAgIHNlbGVjdGVkQ2FyZElkID0gY2FyZElkO1xyXG4gICAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZUNhcmQoZXZ0LCBjYXJkSWQpIHtcclxuICAgIGNvbnN0IGlzTGlrZWQgPSBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcclxuICAgIGFwaS50b2dnbGVMaWtlQ2FyZChjYXJkSWQsIGlzTGlrZWQpXHJcbiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFc2NhcGUoZXZ0KSB7XHJcbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgIGNvbnN0IG9wZW5lZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9pcy1vcGVuZWRcIik7XHJcbiAgICAgICAgaWYgKG9wZW5lZFBvcHVwKSB7XHJcbiAgICAgICAgICAgIGNsb3NlTW9kYWwob3BlbmVkUG9wdXApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XHJcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvdmVybGF5Q2xpY2tMaXN0ZW5lcik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcclxuICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgb3ZlcmxheUNsaWNrTGlzdGVuZXIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlKTtcclxufVxyXG5cclxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudDtcclxuICAgIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50O1xyXG4gICAgcmVzZXRWYWxpZGF0aW9uKFxyXG4gICAgICAgIGVkaXRQcm9maWxlRm9ybSxcclxuICAgICAgICBbZWRpdFByb2ZpbGVOYW1lSW5wdXQsIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXHJcbiAgICAgICAgdmFsaWRhdGlvbkNvbmZpZ1xyXG4gICAgKTtcclxuXHJcbiAgICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XHJcbn0pO1xyXG5cclxubmV3UG9zdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XHJcbn0pO1xyXG5cclxuYXZhdGFyTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fY2xvc2UtYnRuXCIpLmZvckVhY2goKGJ1dHRvbikgPT4ge1xyXG4gICAgY29uc3QgbW9kYWwgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcclxuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChtb2RhbCkpO1xyXG59KTtcclxuXHJcbmVkaXRQcm9maWxlTW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoZXZ0KTtcclxuXHJcbiAgICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gICAgc3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuXHJcbiAgICBhcGkuZWRpdFVzZXJJbmZvKHtcclxuICAgICAgICBuYW1lOiBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcclxuICAgICAgICBhYm91dDogZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgICAgICAgICAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xyXG4gICAgICAgICAgICBlZGl0UHJvZmlsZUZvcm0ucmVzZXQoKTtcclxuICAgICAgICAgICAgZGlzYWJsZWRCdG4oZWRpdFByb2ZpbGVTdWJtaXRCdG4sIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICAgICAgICB9KTtcclxufSk7XHJcblxyXG5uZXdQb3N0TW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoZXZ0KTtcclxuXHJcbiAgICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gICAgc3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuXHJcbiAgICBhcGkuYWRkTmV3Q2FyZCh7XHJcbiAgICAgICAgbmFtZTogbmV3UG9zdENhcHRpb25JbnB1dC52YWx1ZSxcclxuICAgICAgICBsaW5rOiBuZXdQb3N0SW1hZ2VJbnB1dC52YWx1ZSxcclxuICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIG5ld1Bvc3RDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBuZXdQb3N0SW1hZ2VFbC50ZXh0Q29udGVudCA9IGRhdGEubGluaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XHJcbiAgICAgICAgICAgIG5ld1Bvc3RGb3JtLnJlc2V0KCk7XHJcbiAgICAgICAgICAgIGRpc2FibGVkQnRuKG5ld1Bvc3RTdWJtaXRCdG4sIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICAgICAgICB9KTtcclxufSk7XHJcblxyXG5hdmF0YXJNb2RhbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcclxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdChldnQpO1xyXG5cclxuICAgIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG5cclxuICAgIGFwaS5lZGl0QXZhdGFySW5mbyhhdmF0YXJJbWFnZUlucHV0LnZhbHVlKVxyXG4gICAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gZGF0YS5hdmF0YXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XHJcbiAgICAgICAgICAgIGF2YXRhck1vZGFsRm9ybS5yZXNldCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICAgICAgICB9KTtcclxufSk7XHJcblxyXG5kZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcclxuXHJcbmNvbnN0IG92ZXJsYXlDbGlja0xpc3RlbmVyID0gKGV2dCkgPT4ge1xyXG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcclxuICAgICAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcclxuIiwiY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICAgICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QXBwSW5mbygpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgICAgIGFib3V0LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBhdmF0YXIsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkTmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgICAgIGxpbmssXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlQ2FyZChfaWQpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtfaWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVMaWtlQ2FyZChfaWQsIGlzTGlrZWQpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtfaWR9L2xpa2VzYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBcGk7XHJcbiJdLCJuYW1lcyI6WyJoaWRlSW5wdXRFcnJvciIsImZvcm1FbCIsImlucHV0RWwiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZXJyb3JFbCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImlucHV0RXJyb3JDbGFzcyIsInRleHRDb250ZW50IiwiZXJyb3JDbGFzcyIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkQnRuIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiYWRkIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdEF2YXRhckluZm8iLCJhdmF0YXIiLCJhZGROZXdDYXJkIiwibGluayIsImRlbGV0ZUNhcmQiLCJfaWQiLCJ0b2dnbGVMaWtlQ2FyZCIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJkYXRhIiwiZm9yRWFjaCIsIml0ZW0iLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwiYXBwZW5kIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJlZGl0UHJvZmlsZUJ0biIsImRvY3VtZW50IiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlRm9ybSIsImVkaXRQcm9maWxlTmFtZUlucHV0IiwiZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwibmV3UG9zdEJ0biIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RTdWJtaXRCdG4iLCJuZXdQb3N0Rm9ybSIsIm5ld1Bvc3RJbWFnZUlucHV0IiwibmV3UG9zdENhcHRpb25JbnB1dCIsIm5ld1Bvc3RJbWFnZUVsIiwibmV3UG9zdENhcHRpb25FbCIsImF2YXRhck1vZGFsQnRuIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJNb2RhbEZvcm0iLCJhdmF0YXJJbWFnZUlucHV0IiwicHJvZmlsZUF2YXRhckVsIiwiZGVsZXRlTW9kYWwiLCJjYW5jZWxNb2RhbEJ0biIsImRlbGV0ZU1vZGFsQnRuIiwiZGVsZXRlRm9ybSIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsImNhcmRUZW1wbGF0ZSIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbEltYWdlRWwiLCJwcmV2aWV3TW9kYWxDYXB0aW9uRWwiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbCIsImNhcmRJbWFnZUVsIiwic3JjIiwiYWx0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsImNhcmRJZCIsInRhcmdldCIsImNvbnRhaW5zIiwidG9nZ2xlIiwiaGFuZGxlTGlrZUNhcmQiLCJvcGVuTW9kYWwiLCJoYW5kbGVEZWxldGVDYXJkIiwiY2xvc2VNb2RhbCIsImhhbmRsZUVzY2FwZSIsImtleSIsIm9wZW5lZFBvcHVwIiwibW9kYWwiLCJvdmVybGF5Q2xpY2tMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJ2YWx1ZSIsInJlc2V0VmFsaWRhdGlvbiIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJjbG9zZXN0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRCdG4iLCJzdWJtaXR0ZXIiLCJyZXNldCIsImVkaXRQcm9maWxlU3VibWl0QnRuIiwiZmluYWxseSIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIiwiZW5hYmxlVmFsaWRhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=